<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estad√≠sticas Senior - CB Valsequillo</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, #2D8B3C 0%, #1b5e25 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #2D8B3C;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 1.1em;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2D8B3C;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #2D8B3C;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        input,
        select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            font-family: 'Outfit', sans-serif;
            transition: border-color 0.3s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #2D8B3C;
        }

        .players-table {
            width: 100%;
            overflow-x: auto;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th {
            background: #2D8B3C;
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-size: 0.85em;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            padding: 8px;
            border: 1px solid #e0e0e0;
            text-align: center;
        }

        td input {
            width: 100%;
            padding: 8px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            text-align: center;
            font-size: 0.9em;
        }

        td input:focus {
            border-color: #2D8B3C;
            background: #f0fdf4;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Outfit', sans-serif;
        }

        .btn-primary {
            background: #2D8B3C;
            color: white;
        }

        .btn-primary:hover {
            background: #1b5e25;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(45, 139, 60, 0.3);
        }

        .btn-secondary {
            background: #FF9800;
            color: white;
        }

        .btn-secondary:hover {
            background: #F57C00;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #f44336;
            color: white;
            padding: 6px 12px;
            font-size: 0.85em;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
        }

        .add-player-btn {
            margin-top: 15px;
        }

        .input-small {
            width: 60px;
        }

        .input-medium {
            width: 120px;
        }

        .success-message {
            background: #4CAF50;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            text-align: center;
            font-weight: 600;
        }

        .success-message.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.8em;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .players-table {
                font-size: 0.85em;
            }

            th,
            td {
                padding: 6px 4px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üèÄ Registro de Estad√≠sticas</h1>
        <p class="subtitle">CB Valsequillo - Equipo Senior Masculino</p>

        <div class="success-message" id="successMessage">
            ‚úÖ ¬°Partido guardado correctamente!
        </div>

        <form id="statsForm">
            <!-- SELECTOR R√ÅPIDO DE PARTIDO -->
            <div class="section" style="background: #f0fdf4; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                <h2 class="section-title" style="border-bottom: none; margin-bottom: 15px;">‚ö° Selecci√≥n R√°pida</h2>
                <div class="form-group">
                    <label for="partidoSelect">Selecciona un partido registrado (se rellenan los datos
                        autom√°ticamente):</label>
                    <select id="partidoSelect" style="font-size: 1.1em; padding: 15px;">
                        <option value="">-- O rellena manualmente abajo --</option>
                    </select>
                </div>
            </div>

            <!-- DATOS DEL PARTIDO -->
            <div class="section">
                <h2 class="section-title">üìã Datos del Partido</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="rival">Rival *</label>
                        <input type="text" id="rival" required placeholder="Ej: ARMAS">
                    </div>
                    <div class="form-group">
                        <label for="fecha">Fecha *</label>
                        <input type="date" id="fecha" required>
                    </div>
                    <div class="form-group">
                        <label for="ubicacion">Ubicaci√≥n *</label>
                        <select id="ubicacion" required>
                            <option value="">Seleccionar...</option>
                            <option value="Casa">Casa</option>
                            <option value="Fuera">Fuera</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="categoria">Categor√≠a</label>
                        <input type="text" id="categoria" readonly placeholder="Auto" style="background: #f5f5f5;">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="resultado1">1¬∫ Cuarto (Nosotros-Rival)</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="number" id="resultado1_nosotros" min="0" placeholder="0" style="width: 80px;">
                            <span style="font-weight: 600;">-</span>
                            <input type="number" id="resultado1_rival" min="0" placeholder="0" style="width: 80px;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="resultado2">2¬∫ Cuarto</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="number" id="resultado2_nosotros" min="0" placeholder="0" style="width: 80px;">
                            <span style="font-weight: 600;">-</span>
                            <input type="number" id="resultado2_rival" min="0" placeholder="0" style="width: 80px;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="resultado3">3¬∫ Cuarto</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="number" id="resultado3_nosotros" min="0" placeholder="0" style="width: 80px;">
                            <span style="font-weight: 600;">-</span>
                            <input type="number" id="resultado3_rival" min="0" placeholder="0" style="width: 80px;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="resultado4">4¬∫ Cuarto</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="number" id="resultado4_nosotros" min="0" placeholder="0" style="width: 80px;">
                            <span style="font-weight: 600;">-</span>
                            <input type="number" id="resultado4_rival" min="0" placeholder="0" style="width: 80px;">
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="resultado_final">Resultado Final *</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="number" id="resultado_final_nosotros" min="0" required placeholder="0"
                                style="width: 100px;">
                            <span style="font-weight: 800; font-size: 1.2em;">-</span>
                            <input type="number" id="resultado_final_rival" min="0" required placeholder="0"
                                style="width: 100px;">
                        </div>
                    </div>
                </div>
            </div>

            <!-- ESTAD√çSTICAS JUGADORES -->
            <div class="section">
                <h2 class="section-title">üë• Estad√≠sticas por Jugador</h2>

                <div class="players-table">
                    <table id="playersTable">
                        <thead>
                            <tr>
                                <th style="width: 60px;">#</th>
                                <th style="min-width: 120px;">Jugador</th>
                                <th title="Tiros de Campo" colspan="5">TC (1-5)</th>
                                <th title="Tiros Libres">TL</th>
                                <th title="Rebotes Defensivos">RD</th>
                                <th title="Rebotes Ofensivos">RO</th>
                                <th title="Rebotes Totales">RT</th>
                                <th title="Recuperaciones">REC</th>
                                <th title="P√©rdidas">PER</th>
                                <th title="Asistencias">ASS</th>
                                <th title="Tapones">TAP</th>
                                <th style="width: 80px;">Acci√≥n</th>
                            </tr>
                        </thead>
                        <tbody id="playersBody">
                            <!-- Jugadores se a√±aden din√°micamente -->
                        </tbody>
                    </table>
                </div>

                <button type="button" class="btn btn-secondary add-player-btn" onclick="addPlayer()">
                    ‚ûï A√±adir Jugador
                </button>
            </div>

            <!-- ACCIONES -->
            <div class="actions">
                <button type="button" class="btn btn-secondary" onclick="resetForm()">
                    üîÑ Limpiar Todo
                </button>
                <button type="submit" class="btn btn-primary">
                    üíæ Guardar Partido
                </button>
            </div>
        </form>
    </div>

    <script>
        let playerCount = 0;
        let partidosData = [];

        // Cargar partidos al iniciar
        window.onload = function () {
            addPlayer();
            addPlayer();
            addPlayer();

            // Establecer fecha de hoy por defecto
            document.getElementById('fecha').valueAsDate = new Date();

            // Cargar partidos desde JSON
            cargarPartidos();
        };

        async function cargarPartidos() {
            try {
                // Intentar cargar desde la misma carpeta
                const response = await fetch('../partidos_anteriores.json');
                if (!response.ok) throw new Error('No se pudo cargar');

                const data = await response.json();
                partidosData = data;

                // Filtrar solo partidos SENIOR y futuros/recientes
                const select = document.getElementById('partidoSelect');
                const hoy = new Date();
                hoy.setHours(0, 0, 0, 0);

                // Ordenar por fecha descendente (m√°s recientes primero)
                const partidosFiltrados = data
                    .filter(p => {
                        // Filtrar senior (case-insensitive)
                        const esSenior = p.categoria &&
                            p.categoria.toLowerCase().includes('sen');
                        return esSenior;
                    })
                    .sort((a, b) => {
                        const fechaA = parsearFecha(a.dia);
                        const fechaB = parsearFecha(b.dia);
                        return fechaB - fechaA; // M√°s reciente primero
                    });

                // A√±adir opciones al select
                partidosFiltrados.forEach((partido, index) => {
                    const option = document.createElement('option');
                    option.value = index;

                    const fecha = partido.dia || 'Fecha desconocida';
                    const hora = partido.hora || '';
                    const local = partido.local || '';
                    const visitante = partido.visitante || '';
                    const categoria = partido.categoria || '';

                    option.textContent = `${fecha} ${hora} - ${local} vs ${visitante} (${categoria})`;
                    option.dataset.partido = JSON.stringify(partido);

                    select.appendChild(option);
                });

                console.log(`‚úÖ Cargados ${partidosFiltrados.length} partidos senior`);

            } catch (error) {
                console.warn('‚ö†Ô∏è No se pudieron cargar partidos autom√°ticamente:', error);
                console.log('Puedes rellenar manualmente el formulario.');
            }
        }

        function parsearFecha(fechaStr) {
            // Parsear fecha en formato "Viernes 09/01/2026" o "09/01/2026"
            const partes = fechaStr.match(/(\d{2})\/(\d{2})\/(\d{4})/);
            if (partes) {
                return new Date(partes[3], partes[2] - 1, partes[1]);
            }
            return new Date();
        }

        // Evento cuando se selecciona un partido
        document.getElementById('partidoSelect').addEventListener('change', function () {
            if (!this.value) return;

            const partido = JSON.parse(this.options[this.selectedIndex].dataset.partido);

            // Rellenar campos autom√°ticamente
            const esLocal = partido.local && partido.local.toLowerCase().includes('valsequillo');
            const rival = esLocal ? partido.visitante : partido.local;

            document.getElementById('rival').value = rival.replace(/\(\d+\)/g, '').trim();
            document.getElementById('categoria').value = partido.categoria || '';
            document.getElementById('ubicacion').value = esLocal ? 'Casa' : 'Fuera';

            // Convertir fecha
            const fecha = parsearFecha(partido.dia);
            const fechaISO = fecha.toISOString().split('T')[0];
            document.getElementById('fecha').value = fechaISO;

            // Mostrar mensaje
            alert(`‚úÖ Datos cargados:\n\nRival: ${rival}\nFecha: ${partido.dia}\nUbicaci√≥n: ${esLocal ? 'Casa' : 'Fuera'}\n\nAhora rellena las estad√≠sticas de los jugadores.`);
        });

        function addPlayer() {
            playerCount++;
            const tbody = document.getElementById('playersBody');
            const row = tbody.insertRow();

            row.innerHTML = `
                <td><input type="number" name="dorsal_${playerCount}" min="0" max="99" placeholder="#" style="width: 50px;"></td>
                <td><input type="text" name="nombre_${playerCount}" placeholder="Nombre" style="width: 120px;"></td>
                <td><input type="number" name="tc1_${playerCount}" min="0" placeholder="0" style="width: 50px;"></td>
                <td><input type="number" name="tc2_${playerCount}" min="0" placeholder="0" style="width: 50px;"></td>
                <td><input type="number" name="tc3_${playerCount}" min="0" placeholder="0" style="width: 50px;"></td>
                <td><input type="number" name="tc4_${playerCount}" min="0" placeholder="0" style="width: 50px;"></td>
                <td><input type="number" name="tc5_${playerCount}" min="0" placeholder="0" style="width: 50px;"></td>
                <td>
                    <div style="display: flex; gap: 2px; align-items: center; justify-content: center;">
                        <input type="number" name="tl_hecho_${playerCount}" min="0" placeholder="0" style="width: 40px;">
                        <span>/</span>
                        <input type="number" name="tl_intento_${playerCount}" min="0" placeholder="0" style="width: 40px;">
                    </div>
                </td>
                <td><input type="number" name="rd_${playerCount}" min="0" placeholder="0" style="width: 50px;"></td>
                <td><input type="number" name="ro_${playerCount}" min="0" placeholder="0" style="width: 50px;"></td>
                <td><input type="number" name="rt_${playerCount}" min="0" placeholder="0" style="width: 50px;"></td>
                <td><input type="number" name="rec_${playerCount}" min="0" placeholder="0" style="width: 50px;"></td>
                <td><input type="number" name="per_${playerCount}" min="0" placeholder="0" style="width: 50px;"></td>
                <td><input type="number" name="ass_${playerCount}" min="0" placeholder="0" style="width: 50px;"></td>
                <td><input type="number" name="tap_${playerCount}" min="0" placeholder="0" style="width: 50px;"></td>
                <td><button type="button" class="btn btn-danger" onclick="removePlayer(this)">üóëÔ∏è</button></td>
            `;
        }

        function removePlayer(btn) {
            if (confirm('¬øEliminar este jugador?')) {
                btn.closest('tr').remove();
            }
        }

        function resetForm() {
            if (confirm('¬øLimpiar todo el formulario? Se perder√°n los datos no guardados.')) {
                document.getElementById('statsForm').reset();
                document.getElementById('playersBody').innerHTML = '';
                playerCount = 0;
                addPlayer();
                addPlayer();
                addPlayer();
            }
        }

        document.getElementById('statsForm').addEventListener('submit', function (e) {
            e.preventDefault();

            // Recoger datos del partido
            const partidoData = {
                rival: document.getElementById('rival').value,
                fecha: document.getElementById('fecha').value,
                ubicacion: document.getElementById('ubicacion').value,
                resultado: {
                    cuarto1: [
                        parseInt(document.getElementById('resultado1_nosotros').value) || 0,
                        parseInt(document.getElementById('resultado1_rival').value) || 0
                    ],
                    cuarto2: [
                        parseInt(document.getElementById('resultado2_nosotros').value) || 0,
                        parseInt(document.getElementById('resultado2_rival').value) || 0
                    ],
                    cuarto3: [
                        parseInt(document.getElementById('resultado3_nosotros').value) || 0,
                        parseInt(document.getElementById('resultado3_rival').value) || 0
                    ],
                    cuarto4: [
                        parseInt(document.getElementById('resultado4_nosotros').value) || 0,
                        parseInt(document.getElementById('resultado4_rival').value) || 0
                    ],
                    final: [
                        parseInt(document.getElementById('resultado_final_nosotros').value),
                        parseInt(document.getElementById('resultado_final_rival').value)
                    ]
                },
                jugadores: []
            };

            // Recoger datos de jugadores
            const rows = document.getElementById('playersBody').getElementsByTagName('tr');
            for (let i = 0; i < rows.length; i++) {
                const inputs = rows[i].getElementsByTagName('input');
                const dorsal = inputs[0].value;
                const nombre = inputs[1].value;

                // Solo a√±adir si tiene al menos nombre o dorsal
                if (nombre || dorsal) {
                    const jugador = {
                        dorsal: parseInt(dorsal) || '',
                        nombre: nombre || '',
                        tc: [
                            parseInt(inputs[2].value) || 0,
                            parseInt(inputs[3].value) || 0,
                            parseInt(inputs[4].value) || 0,
                            parseInt(inputs[5].value) || 0,
                            parseInt(inputs[6].value) || 0
                        ],
                        tl: {
                            hecho: parseInt(inputs[7].value) || 0,
                            intento: parseInt(inputs[8].value) || 0
                        },
                        rd: parseInt(inputs[9].value) || 0,
                        ro: parseInt(inputs[10].value) || 0,
                        rt: parseInt(inputs[11].value) || 0,
                        rec: parseInt(inputs[12].value) || 0,
                        per: parseInt(inputs[13].value) || 0,
                        ass: parseInt(inputs[14].value) || 0,
                        tap: parseInt(inputs[15].value) || 0
                    };
                    partidoData.jugadores.push(jugador);
                }
            }

            console.log('Datos del partido:', partidoData);

            // Guardar en localStorage (temporal)
            const partidos = JSON.parse(localStorage.getItem('partidos') || '[]');
            partidos.push(partidoData);
            localStorage.setItem('partidos', JSON.stringify(partidos));

            // Mostrar mensaje √©xito
            const successMsg = document.getElementById('successMessage');
            successMsg.classList.add('show');
            setTimeout(() => successMsg.classList.remove('show'), 3000);

            // Limpiar formulario
            setTimeout(() => {
                if (confirm('Partido guardado. ¬øLimpiar formulario para registrar otro partido?')) {
                    resetForm();
                }
            }, 500);

            // TODO: Aqu√≠ se enviar√° a Google Sheets
            alert('Partido guardado localmente!\n\n(En la versi√≥n final se guardar√° en Google Sheets)');
        });
    </script>
</body>

</html>