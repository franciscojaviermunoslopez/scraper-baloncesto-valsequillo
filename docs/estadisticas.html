<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estad√≠sticas Senior - CB Valsequillo</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, #2D8B3C 0%, #1b5e25 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #2D8B3C;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .back-link {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background: #2D8B3C;
            color: white;
            text-decoration: none;
            border-radius: 10px;
            transition: background 0.3s;
        }

        .back-link:hover {
            background: #1b5e25;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .stat-card h2 {
            color: #2D8B3C;
            font-size: 1.5em;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #2D8B3C;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: #f5f5f5;
            border-radius: 10px;
            transition: transform 0.3s;
        }

        .stat-item:hover {
            transform: translateX(5px);
            background: #f0fdf4;
        }

        .stat-item.first {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: white;
            font-weight: 600;
        }

        .stat-item.second {
            background: linear-gradient(135deg, #C0C0C0 0%, #A8A8A8 100%);
            color: white;
        }

        .stat-item.third {
            background: linear-gradient(135deg, #CD7F32 0%, #B8860B 100%);
            color: white;
        }

        .player-name {
            font-weight: 600;
            font-size: 1.1em;
        }

        .player-stats {
            font-size: 1.2em;
            font-weight: 800;
        }

        .resultado-item {
            padding: 15px;
            margin: 10px 0;
            border-left: 5px solid #2D8B3C;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .resultado-item.victoria {
            border-left-color: #4CAF50;
            background: #f0fdf4;
        }

        .resultado-item.derrota {
            border-left-color: #f44336;
            background: #fef2f2;
        }

        .resultado-fecha {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .resultado-marcador {
            font-size: 1.2em;
            font-weight: 600;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 1.3em;
        }

        .error {
            background: #f44336;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üìä Estad√≠sticas Senior Masculino</h1>
            <p class="subtitle">CB Valsequillo - Temporada 2025/2026</p>
            <a href="index.html" class="back-link">‚Üê Volver al Calendario</a>
        </div>

        <div id="loading" class="loading">
            ‚è≥ Cargando estad√≠sticas...
        </div>

        <div id="error" class="error" style="display: none;"></div>

        <div id="stats" style="display: none;">
            <div class="stats-grid">
                <!-- M√ÅXIMO ANOTADOR -->
                <div class="stat-card">
                    <h2>üèÜ M√°ximo Anotador</h2>
                    <div id="anotadores"></div>
                </div>

                <!-- MEJOR REBOTEADOR -->
                <div class="stat-card">
                    <h2>üí™ Mejor Reboteador</h2>
                    <div id="reboteadores"></div>
                </div>

                <!-- MEJOR ASISTENTE -->
                <div class="stat-card">
                    <h2>üéØ M√°s Asistencias</h2>
                    <div id="asistentes"></div>
                </div>
            </div>

            <!-- √öLTIMOS RESULTADOS -->
            <div class="stat-card">
                <h2>üìà √öltimos Resultados</h2>
                <div id="resultados"></div>
            </div>
        </div>
    </div>

    <script>
        const SHEET_ID = '1dPd2nflNE62dzJlIwvmHMe6ZTMtkbh_eg3fldBKwPrQ';

        async function cargarEstadisticas() {
            try {
                // Cargar hoja JUGADORES
                const urlJugadores = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=JUGADORES`;
                const responseJugadores = await fetch(urlJugadores);
                const csvJugadores = await responseJugadores.text();

                // Cargar hoja PARTIDOS
                const urlPartidos = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=PARTIDOS`;
                const responsePartidos = await fetch(urlPartidos);
                const csvPartidos = await responsePartidos.text();

                // Parsear CSV
                const jugadores = parseCSV(csvJugadores);
                const partidos = parseCSV(csvPartidos);

                // Calcular estad√≠sticas
                calcularEstadisticas(jugadores, partidos);

                document.getElementById('loading').style.display = 'none';
                document.getElementById('stats').style.display = 'block';

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 'Error al cargar estad√≠sticas. Aseg√∫rate de que el Google Sheet sea p√∫blico.';
            }
        }

        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());

            return lines.slice(1).map(line => {
                const values = line.split(',').map(v => v.replace(/"/g, '').trim());
                const obj = {};
                headers.forEach((header, i) => {
                    obj[header] = values[i] || '';
                });
                return obj;
            });
        }

        function calcularEstadisticas(jugadores, partidos) {
            // Agrupar estad√≠sticas por jugador
            const statsJugadores = {};

            jugadores.forEach(j => {
                const nombre = j['Jugador'] || '';
                if (!nombre) return;

                if (!statsJugadores[nombre]) {
                    statsJugadores[nombre] = {
                        nombre: nombre,
                        partidos: 0,
                        puntos: 0,
                        rebotes: 0,
                        asistencias: 0,
                        tl_hecho: 0,
                        tl_intento: 0
                    };
                }

                statsJugadores[nombre].partidos++;

                // Calcular puntos totales de TC (asumiendo TC1=1pt, TC2=2pts, etc.)
                const tc1 = parseInt(j['TC1']) || 0;
                const tc2 = parseInt(j['TC2']) || 0;
                const tc3 = parseInt(j['TC3']) || 0;
                const tc4 = parseInt(j['TC4']) || 0;
                const tc5 = parseInt(j['TC5']) || 0;
                const tlHecho = parseInt(j['TL Hecho']) || 0;

                statsJugadores[nombre].puntos += tc1 + tc2 + tc3 + tc4 + tc5 + tlHecho;
                statsJugadores[nombre].rebotes += parseInt(j['RT']) || 0;
                statsJugadores[nombre].asistencias += parseInt(j['ASS']) || 0;
                statsJugadores[nombre].tl_hecho += tlHecho;
                statsJugadores[nombre].tl_intento += parseInt(j['TL Intento']) || 0;
            });

            // Convertir a array y ordenar
            const jugadoresArray = Object.values(statsJugadores);

            // Top anotadores
            const topAnotadores = jugadoresArray
                .sort((a, b) => b.puntos - a.puntos)
                .slice(0, 5);

            // Top reboteadores
            const topReboteadores = jugadoresArray
                .sort((a, b) => b.rebotes - a.rebotes)
                .slice(0, 5);

            // Top asistentes
            const topAsistentes = jugadoresArray
                .sort((a, b) => b.asistencias - a.asistencias)
                .slice(0, 5);

            // Mostrar tops
            mostrarTop('anotadores', topAnotadores, (j) => `${j.puntos} pts (${j.partidos} p.)`);
            mostrarTop('reboteadores', topReboteadores, (j) => `${j.rebotes} reb (${j.partidos} p.)`);
            mostrarTop('asistentes', topAsistentes, (j) => `${j.asistencias} ast (${j.partidos} p.)`);

            // Mostrar √∫ltimos resultados
            mostrarResultados(partidos.reverse().slice(0, 10));
        }

        function mostrarTop(elementId, jugadores, formatStat) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';

            jugadores.forEach((j, index) => {
                const classes = ['stat-item'];
                if (index === 0) classes.push('first');
                else if (index === 1) classes.push('second');
                else if (index === 2) classes.push('third');

                container.innerHTML += `
                    <div class="${classes.join(' ')}">
                        <span class="player-name">${index + 1}. ${j.nombre}</span>
                        <span class="player-stats">${formatStat(j)}</span>
                    </div>
                `;
            });
        }

        function mostrarResultados(partidos) {
            const container = document.getElementById('resultados');
            container.innerHTML = '';

            partidos.forEach(p => {
                const nosotros = parseInt(p['Nosotros']) || 0;
                const rival = parseInt(p['Rival']) || 0;
                const tipoResultado = p['Resultado'] || '';

                const claseResultado = tipoResultado === 'VICTORIA' ? 'victoria' :
                    tipoResultado === 'DERROTA' ? 'derrota' : '';

                const icono = tipoResultado === 'VICTORIA' ? '‚úÖ' :
                    tipoResultado === 'DERROTA' ? '‚ùå' : '‚ö™';

                container.innerHTML += `
                    <div class="resultado-item ${claseResultado}">
                        <div class="resultado-fecha">${p['Fecha']} - ${p['Ubicaci√≥n']}</div>
                        <div class="resultado-marcador">
                            ${icono} VALSEQUILLO ${nosotros} - ${rival} ${p['Rival']}
                        </div>
                    </div>
                `;
            });
        }

        // Cargar al iniciar
        cargarEstadisticas();

        // Recargar cada 5 minutos
        setInterval(cargarEstadisticas, 5 * 60 * 1000);
    </script>
</body>

</html>